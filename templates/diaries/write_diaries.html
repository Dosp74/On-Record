{% extends 'base.html' %}
{% load static %}

{% block style %}
<link rel="stylesheet" href="{% static 'css/write_diaries.css' %}">
{% endblock %}

{% block content %}
    <div class="background-a"></div>
    <div class="write-container">
        <!-- form을 여기서 시작 -->
        <form method="POST" action="{% url 'diaries:write_diaries' %}?day={{selected_date.day}}&month={{selected_date.month}}&year={{selected_date.year}}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="write-header">
                <div class="today-diary">오늘의 일기</div>
                <div class="write-header-l">
                    <h1 id="date"></h1>
                    <button type="button" id="toggle-disclosure" class="public-btn" data-status="{{ form.disclosure.value }}">
                        {% if form.disclosure.value %}
                            비공개
                        {% else %}
                            전체공개
                        {% endif %}
                    </button>
                    {{ form.disclosure }}
                </div>
            </div>

            <div class="write-header-a">
                <div style="display: flex; gap: 20px; justify-content: center;">
                    <div class="form-group">
                        <label>제목</label>
                        {{ form.title }}
                    </div>
                    <div class="write-header-a-l">
                        <div class="form-group">
                            <label>날씨</label>
                            {{ form.weather }}
                        </div>
                        <div class="form-group">
                            <label>기분</label>
                            {{ form.mood }}
                        </div>
                        <div class="form-group">
                            <label>누구에게 쓰실 건가요?</label>
                            {{ form.friend }}
                        </div>
                    </div>
                </div>
            </div>

            <div class="diary-content">
                <div class="image-upload">
                    <label for="id_image">이미지 업로드</label>
                    {{ form.image }}
                </div>
                <div class="text-input">
                    <label for="id_content">내용</label>
                    {{ form.content }}
                </div>
            </div>
            <a href="{% url 'diaries:diaries_detail' %}" class="move-form-btn">
            <button type="submit" class="create-btn">완료</button>
        </form>
    </div>

    <script>
        function formatDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const daysOfWeek = ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일'];
            const dayOfWeek = daysOfWeek[today.getDay()];
            document.getElementById("date").textContent = `${year}/${month}/${day} ${dayOfWeek}`;
        }

        document.addEventListener("DOMContentLoaded", function () {
            formatDate();
            const toggleBtn = document.getElementById("toggle-disclosure");
            const disclosureField = document.getElementById("id_disclosure");
        
            toggleBtn.addEventListener("click", function () {
                let currentStatus = toggleBtn.getAttribute("data-status") === "True";
                let newStatus = !currentStatus; // 상태 반전
        
                console.log("Before change:", currentStatus); // 디버깅용
                console.log("New status:", newStatus); // 디버깅용
        
                toggleBtn.textContent = newStatus ? "비공개" : "전체공개";
                disclosureField.checked = newStatus; // 체크 상태 변경
                disclosureField.value = newStatus ? "true" : "false"; // value 변경
                toggleBtn.setAttribute("data-status", newStatus);
        
                console.log("Updated disclosureField.value:", disclosureField.value); // 디버깅 확인
            });
        });        
    </script>
{% endblock %}
